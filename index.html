<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>æ–°ç”Ÿå½•å…¥ç³»ç»Ÿ</title>
  <style>
    body {
      font-family: "å¾®è½¯é›…é»‘", sans-serif;
      margin: 30px;
    }
    input, button {
      margin: 5px 0;
      padding: 8px;
      width: 250px;
      display: block;
    }
    button {
      width: 260px;
    }
    .section {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>

  <h1>ğŸ“ æ–°ç”Ÿä¿¡æ¯å½•å…¥ç³»ç»Ÿ</h1>

  <div class="section">
    <h2>ğŸ“¥ æäº¤ä½ çš„ä¿¡æ¯</h2>
    <input type="text" id="name" placeholder="å§“å">
    <input type="text" id="studentId" placeholder="å­¦å·">
    <input type="text" id="wechat" placeholder="å¾®ä¿¡å·">
    <button onclick="register()">æäº¤ä¿¡æ¯</button>
    <p id="registerResult" style="color: green;"></p>
  </div>

  <div class="section">
    <h2>ğŸ” æŸ¥çœ‹ç­çº§ä¿¡æ¯</h2>
    <input type="text" id="queryId" placeholder="è¯·è¾“å…¥ä½ çš„å­¦å·">
    <button onclick="getClassInfo()">æŸ¥è¯¢</button>
    <div id="classInfo" style="margin-top: 15px;"></div>
  </div>

  <div class="section">
    <h2>âœï¸ ä¿®æ”¹ / åˆ é™¤æˆ‘çš„ä¿¡æ¯</h2>
    <input type="text" id="editStudentId" placeholder="è¯·è¾“å…¥å­¦å·ï¼ˆå¿…å¡«ï¼‰">
    <input type="text" id="editName" placeholder="æ–°çš„åå­—ï¼ˆå¯é€‰ï¼‰">
    <input type="text" id="editWechat" placeholder="æ–°çš„å¾®ä¿¡å·ï¼ˆå¯é€‰ï¼‰">
    <button onclick="updateInfo()">æ›´æ–°ä¿¡æ¯</button>
    <button onclick="deleteInfo()">åˆ é™¤æˆ‘çš„ä¿¡æ¯</button>
  </div>

  <div class="section">
    <h2>ğŸ—ºï¸ æ ¡å›­åœ°å›¾</h2>
    <img src="æ ¡å›­åœ°å›¾.jpg" alt="æ ¡å›­åœ°å›¾" style="max-width: 100%; height: auto; border: 1px solid #ccc;">
  </div>

  <script>
    // å¦‚æœä½ è¦è®©åˆ«äººè®¿é—®ï¼ŒæŠŠè¿™é‡Œæ”¹æˆä½ ç”µè„‘çš„ IP åœ°å€ï¼ˆå¦‚ 192.168.1.100ï¼‰
    const BASE_URL = 'http://localhost:3001';

    async function register() {
      const name = document.getElementById('name').value.trim();
      const studentId = document.getElementById('studentId').value.trim();
      const wechat = document.getElementById('wechat').value.trim();
      const resultEl = document.getElementById('registerResult');

      if (!name || !studentId || !wechat) {
        resultEl.innerText = 'è¯·å¡«å†™æ‰€æœ‰ä¿¡æ¯ï¼';
        return;
      }

      try {
        const res = await fetch(`${BASE_URL}/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, studentId, wechat })
        });
        const data = await res.json();
        resultEl.innerText = data.message || 'æœªçŸ¥é”™è¯¯';
      } catch (err) {
        resultEl.innerText = 'è¿æ¥æœåŠ¡å™¨å¤±è´¥';
      }
    }

    async function getClassInfo() {
      const studentId = document.getElementById('queryId').value.trim();
      const classInfoDiv = document.getElementById('classInfo');

      if (!studentId) {
        classInfoDiv.innerText = 'è¯·è¾“å…¥å­¦å·';
        return;
      }

      try {
        const res = await fetch(`${BASE_URL}/class-info`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ studentId })
        });
        const data = await res.json();

        if (data.classmates) {
          let html = `<p>ğŸ›ï¸ ä½ çš„å¯å®¤ï¼š${data.yourInfo.dorm}</p>`;
          html += `<p>ğŸ‘¨â€ğŸ“ ä½ çš„ç­çº§ï¼š${data.yourInfo.classId}</p>`;
          html += `<h3>ğŸ‘« åŒç­åŒå­¦ï¼š</h3><ul>`;
          data.classmates.forEach(s => {
            html += `<li>${s.name} - å¾®ä¿¡ï¼š${s.wechat}</li>`;
          });
          html += `</ul>`;
          classInfoDiv.innerHTML = html;
        } else {
          classInfoDiv.innerText = data.message || 'æŸ¥è¯¢å¤±è´¥';
        }
      } catch (err) {
        classInfoDiv.innerText = 'æ— æ³•è¿æ¥æœåŠ¡å™¨';
      }
    }

    function updateInfo() {
      const studentId = document.getElementById('editStudentId').value.trim();
      const name = document.getElementById('editName').value.trim();
      const wechat = document.getElementById('editWechat').value.trim();

      if (!studentId) {
        alert("è¯·å¡«å†™å­¦å·ï¼");
        return;
      }

      fetch(`${BASE_URL}/update`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ studentId, name, wechat })
      })
      .then(res => res.json())
      .then(data => alert(data.message))
      .catch(() => alert("è¯·æ±‚å¤±è´¥"));
    }

    function deleteInfo() {
      const studentId = document.getElementById('editStudentId').value.trim();
      if (!studentId) {
        alert("è¯·è¾“å…¥å­¦å·ï¼");
        return;
      }

      if (!confirm("ä½ ç¡®å®šè¦åˆ é™¤ä½ çš„ä¿¡æ¯å—ï¼Ÿè¿™å°†æ— æ³•æ¢å¤ï¼")) return;

      fetch(`${BASE_URL}/delete`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ studentId })
      })
      .then(res => res.json())
      .then(data => alert(data.message))
      .catch(() => alert("è¯·æ±‚å¤±è´¥"));
    }
  </script>

</body>
</html>
